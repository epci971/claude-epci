# Decompose Output Templates

> Reference file for `/decompose` command output templates.

---

## INDEX.md Template

````markdown
# {Project Title} ‚Äî Index

> **Generated**: {date}
> **Source**: {source_file}
> **Sub-specs**: {count}
> **Total effort**: {total_days} days

---

## Overview

| ID | Title | Effort | Priority | Dependencies | Status |
|----|-------|--------|----------|--------------|--------|
| S01 | {name} | {d}j | - | - | Pending |
| S02 | {name} | {d}j | - | S01 | Pending |
| ... | ... | ... | ... | ... | ... |

---

## Dependency Graph

```mermaid
flowchart TD
    S01[S01: {name}] --> S02[S02: {name}]
    S02 --> S03[S03: {name}]
    S03 --> S04[S04: {name}]
    S03 --> S05[S05: {name}]
    ...
```
````

---

## Gantt Planning

```mermaid
gantt
    title {Project Title}
    dateFormat  YYYY-MM-DD

    section Foundations
    S01 {name}    :s01, {start_date}, {d1}d
    S02 {name}    :s02, after s01, {d2}d

    section Core
    S03 {name}    :s03, after s02, {d3}d
    ...
```

---

## Usage

### Manual Execution (spec by spec)

```bash
# Analyze and execute a single spec
/epci:brief @{output_dir}/S01-{name}.md
# ‚Üí Routes to /epci:quick (TINY/SMALL) or /epci:epci (STANDARD/LARGE)
```

### Autonomous Execution (overnight)

```bash
# Execute all specs autonomously
/epci:ralph {output_dir}/
# ‚Üí Uses prd.json, executes via @ralph-executor
# ‚Üí Each story routes through /epci:brief ‚Üí /epci:quick or /epci:epci
```

### EPCI Command Reference

| Command | Usage |
|---------|-------|
| `/epci:brief` | Analyze spec/story, assess complexity |
| `/epci:quick` | Fast workflow for TINY/SMALL (<200 LOC) |
| `/epci:epci` | Full workflow for STANDARD/LARGE (>200 LOC) |
| `/epci:ralph` | Autonomous overnight execution |
| `/epci:commit` | Git commit with EPCI context |

---

_Generated by decompose_

````

---

## backlog.md Template

````markdown
# Backlog ‚Äî {Project Title}

> **G√©n√©r√©**: {date}
> **Source PRD**: {source_file}
> **Stories totales**: {total_stories}
> **Dur√©e estim√©e**: {total_hours}h ({total_days}j)
> **Granularit√©**: {granularity}

---

## Vue d'ensemble

| # | ID | T√¢che | Spec | Type | Cmplx | Prio | D√©pendances | Estim. | Status |
|---|-----|-------|------|------|-------|------|-------------|--------|--------|
| 1 | US-001 | {title} | S01 | Script | M | P1 | - | 1.5h | ‚è≥ |
| 2 | US-002 | {title} | S01 | Logic | S | P1 | US-001 | 1h | ‚è≥ |
| 3 | US-003 | {title} | S01 | Logic | S | P1 | US-001 | 1h | ‚è≥ |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

---

## Par Spec

### S01 ‚Äî {Spec Title} ({story_count} stories, {spec_hours}h)

| # | ID | T√¢che | Estim. | D√©pendances | Status |
|---|-----|-------|--------|-------------|--------|
| 1 | US-001 | {title} | 1.5h | - | ‚è≥ |
| 2 | US-002 | {title} | 1h | US-001 | ‚è≥ |
| 3 | US-003 | {title} | 1h | US-001 | ‚è≥ |
| 4 | US-004 | {title} | 1h | US-003 | ‚è≥ |

### S02 ‚Äî {Spec Title} ({story_count} stories, {spec_hours}h)

| # | ID | T√¢che | Estim. | D√©pendances | Status |
|---|-----|-------|--------|-------------|--------|
| 1 | US-005 | {title} | 1.5h | - | ‚è≥ |
| ... | ... | ... | ... | ... | ... |

---

## Statistiques

| M√©trique | Valeur |
|----------|--------|
| Stories totales | {total_stories} |
| Compl√©t√©es | {completed} |
| En cours | {in_progress} |
| √âchou√©es | {failed} |
| Restantes | {remaining} |
| Parall√©lisables | {parallelizable} |
| Chemin critique | {critical_path} stories |

---

## Par Priorit√©

| Priorit√© | Stories | Heures |
|----------|---------|--------|
| P1 (Must) | {p1_count} | {p1_hours}h |
| P2 (Should) | {p2_count} | {p2_hours}h |
| P3 (Could) | {p3_count} | {p3_hours}h |

---

## L√©gende

| Symbole | Status |
|---------|--------|
| ‚è≥ | Pending |
| üîÑ | In Progress |
| ‚úÖ | Completed |
| ‚ùå | Failed |
| üö´ | Blocked |

| Complexit√© | Dur√©e |
|------------|-------|
| S (Small) | < 45 min |
| M (Medium) | 45-90 min |
| L (Large) | > 90 min |

| Type | Description |
|------|-------------|
| Script | Shell scripts, hooks, automation |
| Logic | Business logic, functions |
| API | Endpoints, routes, REST |
| UI | Components, forms, views |
| Test | Test files, specs |
| Task | General tasks |

---

_Generated by /decompose ‚Äî Project: {slug}_
````

---

## SXX-{name}.md Template (Sub-Spec)

```markdown
# Specification ‚Äî {ID}: {Title}

> **Parent project**: {slug}
> **Spec ID**: {ID}
> **Estimated effort**: {effort} day(s)
> **Dependencies**: {deps_list}
> **Blocks**: {blocking_list}

---

## 1. Context

This sub-spec is part of the **{project_title}** project.

**Source**: `{source_file}` ‚Äî {section_reference}

---

## 2. Scope

### Included

{included_list}

### Excluded

{excluded_list}

---

## 3. Tasks

{task_checklist}

---

## 4. Acceptance Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| {ID}-AC1 | {criterion_1} | {verification_1} |
| {ID}-AC2 | {criterion_2} | {verification_2} |
| ... | ... | ... |

---

## 5. Source Reference

> Extract from `{source_file}`

{condensed_relevant_content}

---

*Generated by decompose ‚Äî Project: {slug}*
```

---

## prd.json v2 Template

**Schema version**: 2.0 ‚Äî Enhanced structure for granular tracking

````json
{
  "$schema": "https://epci.dev/schemas/prd-v2.json",
  "version": "2.0",
  "branchName": "feature/{slug}",
  "projectName": "{Project Title}",
  "generatedAt": "{ISO date}",
  "generatedBy": "EPCI /decompose v5.2",
  "config": {
    "max_iterations": 50,
    "test_command": "{detected: npm test | pytest | phpunit}",
    "lint_command": "{detected: eslint | flake8 | phpcs}",
    "granularity": "{small | micro | standard}"
  },
  "userStories": [
    {
      "id": "US-001",
      "title": "Story title from spec",
      "category": "backend",
      "type": "Logic",
      "complexity": "M",
      "priority": 1,
      "status": "pending",
      "passes": false,

      "acceptanceCriteria": [
        {"id": "AC1", "description": "First acceptance criterion", "done": false},
        {"id": "AC2", "description": "Second acceptance criterion", "done": false},
        {"id": "AC3", "description": "Third acceptance criterion", "done": false}
      ],

      "tasks": [
        {"id": "T1", "description": "First task from spec", "done": false},
        {"id": "T2", "description": "Second task from spec", "done": false},
        {"id": "T3", "description": "Write tests", "done": false}
      ],

      "dependencies": {
        "depends_on": [],
        "blocks": ["US-002", "US-003"]
      },

      "execution": {
        "attempts": 0,
        "last_error": null,
        "files_modified": [],
        "completed_at": null,
        "iteration": null
      },

      "testing": {
        "test_files": [],
        "requires_e2e": false,
        "coverage_target": null
      },

      "context": {
        "parent_spec": "S01-core-models.md",
        "parent_brief": "docs/briefs/my-feature/brief-2025-01-14.md",
        "estimated_minutes": 60
      }
    }
  ]
}
````

### Field Descriptions

| Field | Type | Description |
|-------|------|-------------|
| `version` | string | Schema version, always "2.0" |
| `category` | string | backend, frontend, fullstack, infra, test, docs |
| `type` | string | Script, Logic, API, UI, Test, Task |
| `complexity` | string | S (<45min), M (45-90min), L (>90min) |
| `status` | string | pending, in_progress, completed, failed, blocked |
| `passes` | boolean | True when story passes (auto-sets status=completed) |
| `acceptanceCriteria` | array | Structured AC with individual tracking |
| `tasks` | array | Task breakdown with individual tracking |
| `dependencies.depends_on` | array | IDs of stories this depends on |
| `dependencies.blocks` | array | IDs of stories blocked by this |
| `execution` | object | Runtime tracking (attempts, errors, files) |
| `testing` | object | Test metadata (files, e2e, coverage) |
| `context` | object | Traceability (parent spec, brief, estimate) |

### Inference Rules Summary

| Field | Inferred From |
|-------|---------------|
| `category` | Title keywords + file patterns |
| `type` | Title keywords (script/entity/api/component/test) |
| `complexity` | Estimated minutes or task/AC count |
| `acceptanceCriteria[]` | `## Acceptance Criteria` section in spec |
| `tasks[]` | `## Tasks` section or inferred from AC |
| `dependencies` | INDEX.md + "depends on" patterns in spec |

### Business Rules

- **RM1**: `passes = true` ‚Üí `status = "completed"` automatically
- **RM2**: Complexity from time: S=30min, M=60min, L=120min
- **RM3**: IDs are local per story: AC1, AC2, T1, T2
- **RM4**: `blocks[]` is inverse of other stories' `depends_on[]`

---

_Template for prd.json v2 ‚Äî See `ralph-converter` skill for full inference logic_
