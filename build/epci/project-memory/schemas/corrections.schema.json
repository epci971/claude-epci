{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "epci-project-memory-corrections",
  "title": "EPCI Corrections History",
  "description": "Schema for corrections stored in .project-memory/learning/corrections.json",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "corrections": {
      "type": "array",
      "description": "List of applied corrections",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^corr-[0-9]+$",
            "description": "Unique correction ID"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "feature_slug": {
            "type": "string",
            "description": "Feature where correction was applied"
          },
          "type": {
            "type": "string",
            "enum": ["security", "performance", "quality", "test", "documentation"],
            "description": "Category of correction"
          },
          "pattern_id": {
            "type": "string",
            "description": "Identifier for the pattern detected"
          },
          "reason": {
            "type": "string",
            "description": "Human-readable reason for correction"
          },
          "agent": {
            "type": "string",
            "description": "Agent that suggested the correction"
          },
          "file_path": {
            "type": "string",
            "description": "File where correction was applied"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "important", "minor"],
            "description": "Severity of the issue"
          }
        },
        "required": ["id", "timestamp", "type", "pattern_id"]
      }
    },
    "patterns": {
      "type": "object",
      "description": "Aggregated pattern statistics",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "occurrences": {
            "type": "integer",
            "minimum": 1,
            "description": "Number of times this pattern was detected"
          },
          "auto_suggest": {
            "type": "boolean",
            "description": "Whether to auto-suggest this pattern (3+ occurrences)"
          },
          "last_seen": {
            "type": "string",
            "format": "date-time"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "important", "minor"]
          }
        }
      }
    },
    "updated_at": {
      "type": "string",
      "format": "date-time"
    }
  },
  "required": ["version", "corrections"]
}
