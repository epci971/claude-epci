# Specification â€” S02: Hooks-Restructure

> **Parent project**: workflow-optimization-v32
> **Spec ID**: S02
> **Estimated effort**: 1 day
> **Category**: SMALL
> **Priority**: MEDIUM
> **Dependencies**: S01
> **Blocks**: S04

---

## 1. Context

This sub-spec is part of the **Workflow Optimization EPCI v3.2** project.

**Problem**:
- `pre-phase-3` hook is redundant with `post-phase-2`
- No hooks exist for `/epci-brief` phase
- Hook flow is inconsistent

**Solution**: Restructure hooks to add `pre-brief`/`post-brief` and remove redundant `pre-phase-3`.

**Source**: `brief-workflow-optimization-2025-12-23.md` â€” Section 3

---

## 2. Scope

### Included

- Remove `pre-phase-3` hook type (redundant with `post-phase-2`)
- Add `pre-brief` hook type (before exploration)
- Add `post-brief` hook type (after complexity evaluation)
- Keep `on-breakpoint` for logging
- Update documentation and examples

### Excluded

- Changes to hook runner.py internals (keep current execution model)
- New hook examples (only update existing)
- Hook configuration UI

---

## 3. Tasks

### 3.1 Update hooks/README.md

- [ ] Remove `pre-phase-3` from Hook Types table
- [ ] Add `pre-brief` to Hook Types table
- [ ] Add `post-brief` to Hook Types table
- [ ] Update "New Schema" diagram
- [ ] Update Examples Reference table

### 3.2 Update hooks/runner.py

- [ ] Remove `pre-phase-3` from recognized hook types
- [ ] Add `pre-brief` to recognized hook types
- [ ] Add `post-brief` to recognized hook types
- [ ] Add deprecation warning if `pre-phase-3` hook detected

### 3.3 Update epci-brief.md

- [ ] Add `ðŸª Execute pre-brief hooks` at start of Step 1
- [ ] Add `ðŸª Execute post-brief hooks` after Step 5 (output generation)

### 3.4 Update epci.md

- [ ] Remove `ðŸª Execute pre-phase-3 hooks` invocation
- [ ] Update Hook Points table
- [ ] Keep `post-phase-3` (still useful for cleanup)

### 3.5 Cleanup Examples

- [ ] Review `post-phase-3-memory-update.py` â€” migrate to `pre-commit-memory.py`
- [ ] Review `post-phase-3-notify.py` â€” migrate to `post-commit-notify.py`

---

## 4. Acceptance Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| S02-AC1 | pre-brief hooks execute before exploration | Add test hook, verify execution order |
| S02-AC2 | post-brief hooks execute after output | Add test hook, verify execution order |
| S02-AC3 | pre-phase-3 shows deprecation warning | Create pre-phase-3 hook, verify warning |
| S02-AC4 | Existing post-phase-2 hooks still work | Run existing hook, verify no regression |

---

## 5. Impacted Files

| File | Action | Risk |
|------|--------|------|
| `src/hooks/README.md` | Modify | High |
| `src/hooks/runner.py` | Modify | High |
| `src/commands/epci-brief.md` | Modify | Medium |
| `src/commands/epci.md` | Modify | Medium |
| `src/hooks/examples/post-phase-3-notify.py` | Delete/Migrate | Low |
| `src/hooks/examples/post-phase-3-memory-update.py` | Delete/Migrate | Low |
| `CLAUDE.md` | Modify | Low |

---

## 6. Source Reference

> Extract from `brief-workflow-optimization-2025-12-23.md`

### 3. Hooks â€” Restructuration

**Actions**:

| Action | Hook | Raison |
|--------|------|--------|
| **Supprimer** | `pre-phase-3` | Redondant avec post-phase-2 |
| **Ajouter** | `pre-brief` | Charger config externe avant exploration |
| **Ajouter** | `post-brief` | Notifier dÃ©but feature, crÃ©er tickets |
| **Garder** | `on-breakpoint` | Logging fin de workflow |

**Nouveau schÃ©ma**:
```
epci-brief: pre-brief â†’ [explore] â†’ post-brief
epci P1:    pre-phase-1 â†’ [plan] â†’ post-phase-1
epci P2:    pre-phase-2 â†’ [code] â†’ post-phase-2
epci P3:    pre-commit â†’ [commit] â†’ post-commit â†’ post-phase-3 â†’ on-breakpoint
```

---

## 7. Risks & Mitigations

| Risk | Probability | Mitigation |
|------|-------------|------------|
| Existing pre-phase-3 hooks break | Medium | Add deprecation warning, suggest migration |
| Hook timing confusion | Low | Clear documentation with sequence diagram |
| Missing hook context in brief phase | Low | Ensure context includes exploration results |

---

*Generated by epci-decompose â€” Project: workflow-optimization-v32*
