# Specification — S01: Memory-Single-Load

> **Parent project**: workflow-optimization-v32
> **Spec ID**: S01
> **Estimated effort**: 1 day
> **Category**: SMALL
> **Priority**: HIGH
> **Dependencies**: —
> **Blocks**: S02, S04, S05

---

## 1. Context

This sub-spec is part of the **Workflow Optimization EPCI v3.2** project.

**Problem**: `.project-memory/` is currently loaded 3 times per workflow:
- In `/epci-brief`
- In `/epci`
- In `/epci-quick`

**Solution**: Load memory once in `/epci-brief` and pass the context via Feature Document (STANDARD/LARGE) or inline brief (TINY/SMALL).

**Source**: `brief-workflow-optimization-2025-12-23.md` — Section 1

---

## 2. Scope

### Included

- Modify `/epci-brief` to add Step 0: Load Project Memory
- Modify `/epci` to read memory from §1 instead of reloading
- Modify `/epci-quick` to read memory from inline brief
- Add "Memory Summary" section to Feature Document §1
- Update documentation in CLAUDE.md

### Excluded

- Changes to `/epci-spike` (separate optimization)
- Changes to `project-memory-loader` skill internals
- Memory caching implementation (see S05)

---

## 3. Tasks

### 3.1 Update epci-brief.md

- [ ] Add "Step 0: Load Project Memory" section after Overview
- [ ] Modify Step 5 output to include Memory Summary in §1
- [ ] Update inline brief template to include memory context

### 3.2 Update epci.md

- [ ] Remove "Pre-Workflow: Load Project Memory" section from each phase
- [ ] Add note: "Memory context loaded by /epci-brief, available in §1"
- [ ] Update Phase 1 to read memory from Feature Document §1

### 3.3 Update epci-quick.md

- [ ] Remove "Pre-Workflow: Load Project Memory" section
- [ ] Add note: "Memory context available from brief if applicable"
- [ ] Update process to use memory from brief context

### 3.4 Update CLAUDE.md

- [ ] Update section 3.2 to reflect single-load pattern
- [ ] Add diagram showing memory flow: brief → phases

---

## 4. Acceptance Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| S01-AC1 | Memory loaded only once per workflow | Run `/epci-brief` + `/epci`, verify no duplicate load |
| S01-AC2 | Memory context available in §1 | Check Feature Document contains Memory Summary |
| S01-AC3 | epci-quick receives memory from brief | Run `/epci-brief` → `/epci-quick`, verify context |
| S01-AC4 | No regression on memory-less projects | Run workflow without `.project-memory/`, verify success |

---

## 5. Impacted Files

| File | Action | Risk |
|------|--------|------|
| `src/commands/epci-brief.md` | Modify | High |
| `src/commands/epci.md` | Modify | High |
| `src/commands/epci-quick.md` | Modify | Medium |
| `CLAUDE.md` | Modify | Low |

---

## 6. Source Reference

> Extract from `brief-workflow-optimization-2025-12-23.md`

### 1. Mémoire — Chargement Unique

**Problème**: `.project-memory/` chargé 3 fois (epci-brief, epci, epci-quick)

**Solution**:
- Charger uniquement dans `/epci-brief`
- Passer le summary via Feature Document §1 (STANDARD/LARGE)
- Passer le summary via brief inline (TINY/SMALL)

**Gain**: -30-60 sec par workflow

---

## 7. Risks & Mitigations

| Risk | Probability | Mitigation |
|------|-------------|------------|
| Memory not available in /epci if brief skipped | Medium | Add fallback: load if not in context |
| Memory context too large for inline brief | Low | Summarize to essential fields only |
| Breaking change for direct /epci users | Medium | Document: "Always start with /epci-brief" |

---

*Generated by epci-decompose — Project: workflow-optimization-v32*
