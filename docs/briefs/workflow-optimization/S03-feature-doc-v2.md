# Specification — S03: Feature-Doc-V2

> **Parent project**: workflow-optimization-v32
> **Spec ID**: S03
> **Estimated effort**: 1 day
> **Category**: SMALL
> **Priority**: MEDIUM
> **Dependencies**: —
> **Blocks**: —

---

## 1. Context

This sub-spec is part of the **Workflow Optimization EPCI v3.2** project.

**Problem**:
- Feature Document §4 (Finalization) is too lightweight
- §3 and §4 have similar content structure
- §1 has redundant file table (also in §2)

**Solution**: Merge §3 + §4 into single section, streamline §1.

**Source**: `brief-workflow-optimization-2025-12-23.md` — Section 4

---

## 2. Scope

### Included

- Merge §3 (Implementation) + §4 (Finalization) into unified §3
- Remove file table from §1 (keep only in §2)
- Add Memory Summary to §1 (from S01)
- Update all templates in commands

### Excluded

- Migration script for existing Feature Documents
- Changes to Feature Document storage location
- Automated conversion of old format

---

## 3. Tasks

### 3.1 Define New Structure

New Feature Document structure:

```markdown
## §1 — Brief Fonctionnel
- Contexte
- Stack Détecté
- Critères d'Acceptation
- Contraintes
- Hors Scope
- Évaluation + Flags
- Memory Summary (NEW)

## §2 — Plan d'Implémentation
- Fichiers Impactés (tableau UNIQUE - moved from §1)
- Tâches
- Risques
- Validation

## §3 — Implémentation & Finalisation (MERGED)
- Progress
- Tests
- Reviews
- Déviations
- Commit Message
- Documentation
- PR Ready
```

### 3.2 Update epci-brief.md

- [ ] Remove file table from §1 template (lines ~245-260)
- [ ] Add Memory Summary subsection to §1 template
- [ ] Update §3 placeholder text to "Implementation & Finalization"
- [ ] Remove §4 placeholder entirely

### 3.3 Update epci.md

- [ ] Update Phase 2 output to write to §3 (unchanged name)
- [ ] Update Phase 3 output to append to §3 (instead of creating §4)
- [ ] Modify Edit tool instructions for Phase 3
- [ ] Update breakpoint displays to reflect merged section

### 3.4 Update CLAUDE.md

- [ ] Update section 3.3 "Feature Document Pattern"
- [ ] Update "Cycle de vie" table (merge §3+§4 row)
- [ ] Update template example

---

## 4. Acceptance Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| S03-AC1 | Feature Document has 3 sections (§1, §2, §3) | Generate new Feature Doc, verify structure |
| S03-AC2 | §1 has no file table | Check §1 contains only listed subsections |
| S03-AC3 | §3 contains both implementation and finalization | Complete workflow, verify §3 content |
| S03-AC4 | Old 4-section docs still readable | Read existing Feature Doc, verify no error |

---

## 5. Impacted Files

| File | Action | Risk |
|------|--------|------|
| `src/commands/epci-brief.md` | Modify | Medium |
| `src/commands/epci.md` | Modify | High |
| `CLAUDE.md` | Modify | Low |

---

## 6. Source Reference

> Extract from `brief-workflow-optimization-2025-12-23.md`

### 4. Feature Document — Restructuration

**Actions**:

| Action | Détail |
|--------|--------|
| **Fusionner** | §3 (Implémentation) + §4 (Finalisation) → §3 unique |
| **Supprimer** | Tableau fichiers dans §1 (garder uniquement dans §2) |
| **Ajouter** | Memory Summary dans §1 |

**Nouvelle structure**:
```markdown
## §1 — Brief Fonctionnel
- Contexte
- Stack Détecté
- Critères d'Acceptation
- Contraintes
- Hors Scope
- Évaluation + Flags
- Memory Summary (NOUVEAU)

## §2 — Plan d'Implémentation
- Fichiers Impactés (tableau UNIQUE)
- Tâches
- Risques
- Validation

## §3 — Implémentation & Finalisation (FUSIONNÉ)
- Progress
- Tests
- Reviews
- Déviations
- Commit Message
- Documentation
- PR Ready
```

---

## 7. Risks & Mitigations

| Risk | Probability | Mitigation |
|------|-------------|------------|
| Confusion with old 4-section format | Low | Document breaking change clearly |
| Phase 3 append logic complex | Medium | Clear Edit tool instructions |
| Loss of separation concerns | Low | Subsections maintain logical separation |

---

*Generated by epci-decompose — Project: workflow-optimization-v32*
